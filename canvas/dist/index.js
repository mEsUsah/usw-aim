(()=>{"use strict";Math.PI;function t(t,e){t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight,e.scale=Math.min(t.canvas.width/e.gameWidth,t.canvas.height/e.gameHeight),t.scale(e.scale,e.scale),e.offsetX=Math.floor((t.canvas.width/e.scale-e.gameWidth)/2),e.offsetY=Math.floor((t.canvas.height/e.scale-e.gameHeight)/2),t.translate(e.offsetX,e.offsetY),e.screenStartX=-e.offsetX,e.screenStartY=-e.offsetY,e.screenEndX=2*e.offsetX+e.gameWidth,e.screenEndY=2*e.offsetY+e.gameHeight}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function n(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,i||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==e(i)?i:i+""}var o,a,r,l=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.shapes=[],this.state={}},(e=[{key:"addShape",value:function(t){this.shapes.push(t)}},{key:"update",value:function(t){this.shapes.forEach(function(e){e.update(t)}),this.shapes=this.shapes.filter(function(t){return!t.config.ttl||t.lifetime<t.config.ttl})}},{key:"draw",value:function(t){this.shapes.length&&(t.save(),t.translate(this.config.x,this.config.y),this.shapes.forEach(function(e){e.draw(t)}),t.restore())}},{key:"checkCollision",value:function(t,e){return!!this.config.outline&&t>=this.config.x-this.config.outline.left&&t<=this.config.x+this.config.outline.right&&e>=this.config.y-this.config.outline.top&&e<=this.config.y+this.config.outline.bottom}}])&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function f(t,e,i){return(e=h(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==c(e)?e:e+""}o=l,r={BOARD:1,BUTTON:2,TEXT:3,ILLUSTRATION:4},(a=n(a="VARIANT"))in o?Object.defineProperty(o,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[a]=r;var g=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config={},this.config.duration=e.duration||1e3,this.config.loop=e.loop||0,this.config.direction=e.direction||t.FORWARD,this.config.startDelay=e.startDelay||0,this.progress=0,this.lifetime=0,this.loopCount=1}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"updateProgress",value:function(e){this.progress+=e,this.lifetime+=e,this.lifetime<this.config.startDelay&&(this.progress=0),this.progress>this.config.duration&&(this.config.loop===t.INFINITE||this.loopCount<this.config.loop)&&(this.loopCount++,this.progress=this.progress%this.config.duration),this.progress>this.config.duration&&0===this.config.loop&&(this.progress=this.config.duration)}},{key:"getProgress",value:function(){return this.progress/this.config.duration}}])}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}function m(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}f(g,"INFINITE",-1),f(g,"FORWARD",1),f(g,"BACKWARD",2);var p=function(){return function(t,e,i){return e&&d(t.prototype,e),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.config=i,this.animation=null,this.lifetime=0},[{key:"addAnimation",value:function(t){this.animation=t}},{key:"update",value:function(t){this.lifetime+=t,this.animation&&this.animation.updateProgress(t)}},{key:"draw",value:function(t){t.strokeStyle=this.config.color||"red",t.lineWidth=this.config.lineWidth||2,t.save(),t.translate(this.config.x,this.config.y);var e=1,i=g.FORWARD;switch(this.animation&&(e=this.animation.getProgress(),i=this.animation.config.direction),this.type){case"rectangle":t.beginPath(),i===g.FORWARD?t.rect(0,0,this.config.width*e,this.config.height*e):t.rect(this.config.width*(1-e),this.config.height*(1-e),this.config.width*e,this.config.height*e),t.stroke(),this.config.fillColor&&(t.fillStyle=this.config.fillColor,t.fill());break;case"circle":this.config.lineWidth&&(t.lineWidth=this.config.lineWidth),t.beginPath(),i===g.FORWARD?t.arc(0,0,this.config.radius,0,2*Math.PI*e,!1):(1===e&&(e=0),t.arc(0,0,this.config.radius,2*Math.PI*e,0,!1)),t.stroke();break;case"line":this.config.lineWidth&&(t.lineWidth=this.config.lineWidth),t.beginPath(),t.moveTo(0,0),t.lineTo((this.config.x2-this.config.x)*e,(this.config.y2-this.config.y)*e),t.stroke();break;case"polygon":if(!this.config.points||this.config.points.length<2)break;t.beginPath(),t.moveTo(this.config.points[0].x,this.config.points[0].y),this.config.points.forEach(function(e,i){t.lineTo(e.x,e.y)}),t.closePath(),t.stroke(),this.config.fillColor&&(t.fillStyle=this.config.fillColor,t.fill());break;case"text":t.font=this.config.font||"20px Arial",t.fillStyle=this.config.color||"black",t.fillText(this.config.text||"",0,0);break;default:console.warn("GameShape::draw - Unknown shape type: ".concat(this.type))}t.restore()}}])}();function y(t){t.gameObjects.gameplay=t.gameObjects.gameplay.filter(function(t){return"turn_symbol"!==t.config.name});var e=new l({variant:l.VARIANT.ILLUSTRATION,x:165,y:30,name:"turn_symbol"});1==t.playerTurn?(e.addShape(new p("line",{x:-15,y:-15,x2:15,y2:15,color:"rgba(40, 151, 255, 1)",lineWidth:4})),e.addShape(new p("line",{x:15,y:-15,x2:-15,y2:15,color:"rgba(40, 151, 255, 1)",lineWidth:4}))):e.addShape(new p("circle",{x:0,y:0,radius:15,color:"rgba(248, 66, 66, 1)",lineWidth:4})),t.gameObjects.gameplay.push(e)}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function v(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,w(n.key),n)}}function w(t){var e=function(t,e){if("object"!=b(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==b(e)?e:e+""}var T="gameplay",x="menu",S="paused",C=function(){return function(t,e,i){return e&&v(t.prototype,e),i&&v(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(function e(i){var n,o,a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=i,this.ctx=i.getContext("2d"),this.frameData={lastTime:0,deltaTime:0,fps:{accum:0,frames:0,avg:0}},this.displayData={gameWidth:800,gameHeight:800,scale:1,offsetX:0,offsetY:0,screenStartX:0,screenStartY:0,screenEndX:0,screenEndY:0},this.gameMode=x,this.gameObjects={gameplay:[],menu:[],paused:[]},this.userInputs=[],this.playerTurn=1,y(this),function(t){var e=window.devicePixelRatio,i=function(){return+getComputedStyle(t).getPropertyValue("height").slice(0,-2)},n=function(){return+getComputedStyle(t).getPropertyValue("width").slice(0,-2)};t.setAttribute("width",n()*e),t.setAttribute("height",i()*e)}(this.canvas),window.addEventListener("resize",function(){t(a.ctx,a.displayData)}),i.addEventListener("click",function(t){var e=function(t,e,i){var n=i.getBoundingClientRect();return{x:(t.clientX-n.left)/e.scale-e.offsetX,y:(t.clientY-n.top)/e.scale-e.offsetY}}(t,a.displayData,a.canvas);a.userInputs.push({type:"click",x:e.x,y:e.y})}),this.boardSize=4,this.gameConfig=this.config(),n=this,(o=new l({variant:l.VARIANT.BUTTON,x:n.displayData.gameWidth/2,y:n.displayData.gameHeight/2,name:"start_button",outline:{top:60,left:60,bottom:60,right:60}})).addShape(new p("rectangle",{x:-60,y:-60,width:120,height:120,color:"red"})),o.addShape(new p("polygon",{x:-0,y:-0,points:[{x:-30,y:-40},{x:40,y:0},{x:-30,y:40}],color:"red",fillColor:"red"})),n.gameObjects.menu.push(o),function(t){var e=new l({variant:l.VARIANT.BUTTON,x:t.displayData.gameWidth-30,y:30,name:"menu_button",outline:{top:20,left:20,bottom:20,right:20}});e.addShape(new p("rectangle",{x:-20,y:-20,width:40,height:40,color:"red"})),e.addShape(new p("rectangle",{x:-10,y:-10,width:6,height:20,color:"red",fillColor:"red"})),e.addShape(new p("rectangle",{x:10,y:-10,width:-6,height:20,color:"red",fillColor:"red"})),t.gameObjects.gameplay.push(e);var i=new l({variant:l.VARIANT.TEXT,x:30,y:37.5,name:"turn_indicator"});i.addShape(new p("text",{x:0,y:0,text:"Player:",font:"30px Consolas",color:"white"})),t.gameObjects.gameplay.push(i)}(this),function(t){var e=new l({variant:l.VARIANT.BUTTON,x:t.displayData.gameWidth-30,y:30,name:"continue_button",outline:{top:20,left:20,bottom:20,right:20}});e.addShape(new p("rectangle",{x:-20,y:-20,width:40,height:40,color:"red"})),e.addShape(new p("polygon",{points:[{x:-10,y:-10},{x:10,y:0},{x:-10,y:10}],color:"red",fillColor:"red"})),t.gameObjects.paused.push(e);var i=new l({variant:l.VARIANT.BUTTON,x:t.displayData.gameWidth-80,y:30,name:"stop_button",outline:{top:20,left:20,bottom:20,right:20}});i.addShape(new p("rectangle",{x:-20,y:-20,width:40,height:40,color:"red"})),i.addShape(new p("rectangle",{x:-10,y:-10,width:20,height:20,color:"red",fillColor:"red"})),t.gameObjects.paused.push(i);var n=new l({variant:l.VARIANT.TEXT,x:t.displayData.gameWidth/2,y:t.displayData.gameHeight/2,name:"pause_text"});n.addShape(new p("text",{x:-150,y:0,text:"Game Paused",font:"50px Consolas",color:"white"}));var o=new p("line",{x:-150,y:5,x2:150,y2:5,color:"white",lineWidth:4});o.addAnimation(new g({duration:1e3,loop:g.INFINITE})),n.addShape(o),t.gameObjects.paused.push(n)}(this),this.start()},[{key:"config",value:function(){return{boardSize:this.boardSize,boardMargin:60,cellWidth:680/this.boardSize,cellHeight:680/this.boardSize,cellPadding:20}}},{key:"start",value:function(){var e=this;t(this.ctx,this.displayData),window.requestAnimationFrame(function(t){return e.gameLoop(t)})}},{key:"gameLoop",value:function(t){var e,i,n=this;!function(t,e){e.deltaTime=t-e.lastTime,e.lastTime=t,e.fps.accum+=Math.floor(1e3/e.deltaTime),e.fps.frames++,e.fps.frames>=60&&(e.fps.avg=Math.floor(e.fps.accum/e.fps.frames),e.fps.accum=0,e.fps.frames=0)}(t,this.frameData),this.handleUserInputs(),this.gameObjects[this.gameMode].forEach(function(t){t.update(n.frameData.deltaTime)}),e=this.ctx,i=this.displayData,e.clearRect(i.screenStartX,i.screenStartY,i.gameWidth+2*i.offsetX,i.gameHeight+2*i.offsetY),this.gameObjects[this.gameMode].forEach(function(t){t.draw(n.ctx)}),window.requestAnimationFrame(function(t){return n.gameLoop(t)})}},{key:"handleUserInputs",value:function(){var t=this;this.userInputs.forEach(function(e){if("click"==e.type)switch(t.gameMode){case T:t.gameObjects[T].forEach(function(i){if(i.config.variant==l.VARIANT.BOARD&&i.checkCollision(e.x,e.y)&&null==i.state.occupiedBy){if(i.state.occupiedBy=t.playerTurn,1===t.playerTurn){var n=new p("line",{x:t.gameConfig.cellPadding-t.gameConfig.cellWidth/2,y:t.gameConfig.cellPadding-t.gameConfig.cellHeight/2,x2:t.gameConfig.cellWidth/2-t.gameConfig.cellPadding,y2:t.gameConfig.cellHeight/2-t.gameConfig.cellPadding,color:"rgba(40, 151, 255, 1)",lineWidth:4});n.addAnimation(new g({duration:150,direction:g.BACKWARD})),i.addShape(n);var o=new p("line",{x:t.gameConfig.cellPadding-t.gameConfig.cellWidth/2,y:t.gameConfig.cellHeight/2-t.gameConfig.cellPadding,x2:t.gameConfig.cellWidth/2-t.gameConfig.cellPadding,y2:-t.gameConfig.cellHeight/2+t.gameConfig.cellPadding,color:"rgba(40, 151, 255, 1)",lineWidth:4});o.addAnimation(new g({duration:150,startDelay:150})),i.addShape(o),t.playerTurn=2}else{var a=new p("circle",{x:0,y:0,radius:t.gameConfig.cellWidth/2-t.gameConfig.cellPadding,color:"rgba(248, 66, 66, 1)",lineWidth:4});a.addAnimation(new g({duration:300})),i.addShape(a),t.playerTurn=1}y(t)}i.config.variant==l.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)&&"menu_button"===i.config.name&&(t.gameMode=S)});break;case S:t.gameObjects[S].forEach(function(i){i.config.variant==l.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)&&"continue_button"===i.config.name&&(t.gameMode=T),i.config.variant==l.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)&&"stop_button"===i.config.name&&(t.gameMode=x)});break;case x:t.gameObjects[x].forEach(function(i){i.config.variant==l.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)&&"start_button"===i.config.name&&(t.gameMode=T,function(t){t.gameObjects.gameplay=t.gameObjects.gameplay.filter(function(t){return t.config.variant!==l.VARIANT.BOARD});for(var e=0;e<t.gameConfig.boardSize;e++)for(var i=0;i<t.gameConfig.boardSize;i++){var n=new l({variant:l.VARIANT.BOARD,x:t.gameConfig.cellWidth/2+e*t.gameConfig.cellWidth+t.gameConfig.boardMargin,y:t.gameConfig.cellHeight/2+i*t.gameConfig.cellHeight+t.gameConfig.boardMargin,name:"board_".concat(e,"_").concat(i),outline:{top:t.gameConfig.cellHeight/2,left:t.gameConfig.cellWidth/2,bottom:t.gameConfig.cellHeight/2,right:t.gameConfig.cellWidth/2}}),o=new p("rectangle",{x:-t.gameConfig.cellWidth/2,y:-t.gameConfig.cellHeight/2,width:t.gameConfig.cellWidth,height:t.gameConfig.cellHeight,color:"gray"});n.addShape(o),t.gameObjects.gameplay.push(n)}}(t))})}}),this.userInputs=[]}}])}();window.onload=function(){var t=document.getElementById("gameCanvas");new C(t)}})();