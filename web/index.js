(()=>{"use strict";Math.PI;function t(t,e){e.devicePixelRatio=window.devicePixelRatio||1,t.canvas.width=window.innerWidth*e.devicePixelRatio,t.canvas.height=window.innerHeight*e.devicePixelRatio,e.scale=Math.min(t.canvas.width/e.gameWidth,t.canvas.height/e.gameHeight),t.scale(e.scale,e.scale),e.offsetX=Math.floor((t.canvas.width/e.scale-e.gameWidth)/2),e.offsetY=Math.floor((t.canvas.height/e.scale-e.gameHeight)/2),t.translate(e.offsetX,e.offsetY),e.screenStartX=-e.offsetX,e.screenStartY=-e.offsetY,e.screenEndX=2*e.offsetX+e.gameWidth,e.screenEndY=2*e.offsetY+e.gameHeight}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,i||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==e(i)?i:i+""}var n,o,r,s=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.shapes=[],this.state={}},(e=[{key:"addShape",value:function(t){this.shapes.push(t)}},{key:"removeShape",value:function(t){var e=this.shapes.findIndex(function(e){return e.config.name&&e.config.name===t});-1!==e&&this.shapes.splice(e,1)}},{key:"update",value:function(t){this.shapes.forEach(function(e){e.update(t)}),this.shapes=this.shapes.filter(function(t){return!t.config.ttl||t.lifetime<t.config.ttl})}},{key:"draw",value:function(t){this.shapes.length&&(t.save(),t.translate(this.config.x,this.config.y),this.shapes.forEach(function(e){e.draw(t)}),t.restore())}},{key:"checkCollision",value:function(t,e){return!!this.config.outline&&t>=this.config.x-this.config.outline.left&&t<=this.config.x+this.config.outline.right&&e>=this.config.y-this.config.outline.top&&e<=this.config.y+this.config.outline.bottom}}])&&i(t.prototype,e),a&&i(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,a}();function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,f(a.key),a)}}function g(t,e,i){return(e=f(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function f(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==c(e)?e:e+""}n=s,r={BOARD:1,BUTTON:2,TEXT:3,ILLUSTRATION:4},(o=a(o="VARIANT"))in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r;var h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config={},this.config.duration=e.duration||1e3,this.config.loop=e.loop||0,this.config.direction=e.direction||t.FORWARD,this.config.startDelay=e.startDelay||0,this.config.displayDelay=e.displayDelay||0,this.progress=0,this.lifetime=0,this.loopCount=1}return function(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"updateProgress",value:function(e){this.progress+=e,this.lifetime+=e,this.lifetime<=this.config.startDelay&&(this.progress=0),this.progress>this.config.duration&&(this.config.loop===t.INFINITE||this.loopCount<this.config.loop)&&(this.loopCount++,this.progress=this.progress%this.config.duration),this.progress>this.config.duration&&0===this.config.loop&&(this.progress=this.config.duration)}},{key:"getProgress",value:function(){return this.progress/this.config.duration}},{key:"getIsVisible",value:function(){return this.lifetime>=this.config.displayDelay}}])}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function u(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,p(a.key),a)}}function p(t){var e=function(t,e){if("object"!=d(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=d(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==d(e)?e:e+""}g(h,"INFINITE",-1),g(h,"FORWARD",1),g(h,"BACKWARD",2);var m=function(){return function(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.config=i,this.animation=null,this.lifetime=0},[{key:"addAnimation",value:function(t){this.animation=t}},{key:"update",value:function(t){this.lifetime+=t,this.animation&&this.animation.updateProgress(t)}},{key:"draw",value:function(t){var e=1,i=!0,a=h.FORWARD;if(this.animation&&(i=this.animation.getIsVisible(),e=this.animation.getProgress(),a=this.animation.config.direction),i){switch(t.save(),t.translate(this.config.x,this.config.y),t.strokeStyle=this.config.color||"red",t.lineWidth=this.config.lineWidth||2,this.type){case"rectangle":this.config.lineWidth&&(t.lineWidth=this.config.lineWidth),t.beginPath(),a===h.FORWARD?t.rect(0,0,this.config.width*e,this.config.height*e):t.rect(this.config.width*(1-e),this.config.height*(1-e),this.config.width*e,this.config.height*e),t.stroke(),this.config.fillColor&&(t.fillStyle=this.config.fillColor,t.fill());break;case"circle":this.config.lineWidth&&(t.lineWidth=this.config.lineWidth),t.beginPath(),a===h.FORWARD?t.arc(0,0,this.config.radius,0,2*Math.PI*e,!1):(1===e&&(e=0),t.arc(0,0,this.config.radius,2*Math.PI*e,0,!1)),t.stroke();break;case"line":this.config.lineWidth&&(t.lineWidth=this.config.lineWidth),t.beginPath(),a===h.FORWARD?(t.moveTo(0,0),t.lineTo((this.config.x2-this.config.x)*e,(this.config.y2-this.config.y)*e)):(t.moveTo((this.config.x2-this.config.x)*e,(this.config.y2-this.config.y)*e),t.lineTo(this.config.x2-this.config.x,this.config.y2-this.config.y)),t.stroke();break;case"polygon":if(!this.config.points||this.config.points.length<2)break;this.config.lineWidth&&(t.lineWidth=this.config.lineWidth),t.beginPath(),t.moveTo(this.config.points[0].x,this.config.points[0].y),this.config.points.forEach(function(e,i){t.lineTo(e.x,e.y)}),t.closePath(),t.stroke(),this.config.fillColor&&(t.fillStyle=this.config.fillColor,t.fill());break;case"text":t.font=this.config.font||"20px Arial",t.fillStyle=this.config.color||"black",t.textAlign=this.config.align||"left",t.textBaseline=this.config.baseline||"alphabetic",t.fillText(this.config.text||"",0,0);break;default:console.warn("GameShape.draw() - Unknown shape type: ".concat(this.type))}t.restore()}}}])}();function y(t,e){var i=new m("circle",{x:0,y:0,radius:t.config.cellWidth/2-t.config.cellPadding,color:"rgba(248, 66, 66, 1)",lineWidth:4});i.addAnimation(new h({duration:300})),e.addShape(i)}function b(t){t.addShape(new m("rectangle",{x:-20,y:-20,width:40,height:40,color:"gray"})),t.addShape(new m("rectangle",{x:-10,y:-10,width:20,height:20,color:"red",fillColor:"red"}))}function v(t){var e,i=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-30,y:30,name:"pause_button",outline:{top:20,left:20,bottom:20,right:20}});(e=i).addShape(new m("rectangle",{x:-20,y:-20,width:40,height:40,color:"gray"})),e.addShape(new m("rectangle",{x:-10,y:-10,width:6,height:20,color:"red",fillColor:"red"})),e.addShape(new m("rectangle",{x:10,y:-10,width:-6,height:20,color:"red",fillColor:"red"})),t.state.gameObjects.gameplay.push(i);var a=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-80,y:30,name:"stop_button",outline:{top:20,left:20,bottom:20,right:20}});b(a),t.state.gameObjects.gameplay.push(a);var n=new s({variant:s.VARIANT.TEXT,x:30,y:37.5,name:"turn_indicator"});!function(t){t.addShape(new m("text",{x:0,y:0,text:"Player:",font:"30px GameFont",color:"white"}))}(n),t.state.gameObjects.gameplay.push(n)}function w(t){t.state.gameObjects.gameplay=t.state.gameObjects.gameplay.filter(function(t){return"turn_symbol"!==t.config.name});var e,i=new s({variant:s.VARIANT.ILLUSTRATION,x:165,y:30,name:"turn_symbol"});1==t.state.currentPlayer?((e=i).addShape(new m("line",{x:-15,y:-15,x2:15,y2:15,color:"rgba(40, 151, 255, 1)",lineWidth:4})),e.addShape(new m("line",{x:15,y:-15,x2:-15,y2:15,color:"rgba(40, 151, 255, 1)",lineWidth:4}))):function(t){t.addShape(new m("circle",{x:0,y:0,radius:15,color:"rgba(248, 66, 66, 1)",lineWidth:4}))}(i),t.state.gameObjects.gameplay.push(i)}function S(t,e){var i=x(t,e,1,0);if(i)return i;var a=x(t,e,1,1);if(a)return a;var n=x(t,e,0,1);if(n)return n;var o=x(t,e,-1,1);return o||!1}function x(t,e,i,a){for(var n=e.config.location,o={x:null,y:null,x2:null,y2:null},r=e.config.location.x,s=e.config.location.y;r>=0&&s>=0&&r<t.config.boardSize&&s<t.config.boardSize&&t.state.gameFields[r][s].state&&t.state.gameFields[r][s].state.occupiedBy==e.state.occupiedBy;)n=t.state.gameFields[r][s].config.location,o.x=t.state.gameFields[r][s].config.x,o.y=t.state.gameFields[r][s].config.y,r-=i,s-=a;var c=0;for(r=n.x,s=n.y;r<t.config.boardSize&&s<t.config.boardSize&&r>=0&&s>=0&&t.state.gameFields[r][s].state&&t.state.gameFields[r][s].state.occupiedBy==e.state.occupiedBy;){if(++c>=t.state.winLength)return o.x2=t.state.gameFields[r][s].config.x,o.y2=t.state.gameFields[r][s].config.y,o;r+=i,s+=a}return!1}function T(t){var e=Math.pow(t.state.boardSize,2);return t.state.occupiedSpaces>=e}function A(t,e){var i=new s({variant:s.VARIANT.ILLUSTRATION,x:0,y:0,name:"win_line"}),a=new m("line",{x:e.x,y:e.y,x2:e.x2,y2:e.y2,color:"white",lineWidth:15,ttl:300});a.addAnimation(new h({duration:300,direction:h.FORWARD})),i.addShape(a);var n=new m("line",{x:e.x,y:e.y,x2:e.x2,y2:e.y2,color:"white",lineWidth:15,ttl:1e3});n.addAnimation(new h({duration:300,direction:h.BACKWARD,startDelay:600,displayDelay:300})),i.addShape(n),t.state.gameObjects.gameplay.push(i)}function O(t){console.log("Adding draw line");var e=new s({variant:s.VARIANT.ILLUSTRATION,x:0,y:0,name:"win_line"}),i=new m("line",{x:100,y:100,x2:t.displayState.gameWidth-100,y2:t.displayState.gameHeight-100,color:"white",lineWidth:15,ttl:300});i.addAnimation(new h({duration:300,direction:h.FORWARD})),e.addShape(i);var a=new m("line",{x:100,y:100,x2:t.displayState.gameWidth-100,y2:t.displayState.gameHeight-100,color:"white",lineWidth:15,ttl:1e3});a.addAnimation(new h({duration:300,startDelay:600,displayDelay:300,direction:h.BACKWARD})),e.addShape(a);var n=new m("line",{x:t.displayState.gameWidth-100,y:100,x2:100,y2:t.displayState.gameHeight-100,color:"white",lineWidth:15,ttl:300});n.addAnimation(new h({duration:300,direction:h.FORWARD})),e.addShape(n);var o=new m("line",{x:t.displayState.gameWidth-100,y:100,x2:100,y2:t.displayState.gameHeight-100,color:"white",lineWidth:15,ttl:1e3});o.addAnimation(new h({duration:300,startDelay:600,displayDelay:300,direction:h.BACKWARD})),e.addShape(o),t.state.gameObjects.gameplay.push(e)}function W(t,e){var i=new s({variant:s.VARIANT.ILLUSTRATION,x:t.displayState.gameWidth/2,y:t.displayState.gameHeight/2,name:"gameover_text"}),a=new m("text",{x:0,y:0,text:e,font:"84px GameFont",color:"white",align:"center",baseline:"middle"});a.addAnimation(new h({displayDelay:900})),i.addShape(a),t.state.gameObjects.gameplay.push(i)}function P(t){return new m("text",{x:0,y:0,text:t,font:"30px GameFont",color:"white",align:"left",baseline:"middle"})}function N(){return new m("rectangle",{x:-30,y:-30,width:60,height:60,color:"gray"})}function E(t){return new m("text",{x:0,y:0,text:t,font:"30px GameFont",color:"white",align:"center",baseline:"middle"})}function I(){return new m("line",{x:-20,y:17,x2:20,y2:17,color:"red",lineWidth:5,name:"selected_indicator"})}function R(){return new m("rectangle",{x:-25,y:-25,width:50,height:50,color:"#00000088",fillColor:"#000000aa",name:"disabled_overlay"})}function _(t,e){var i="Games Played: ".concat(e.gamesPlayed," | Wins: ").concat(e.gamesWon," | Losses: ").concat(e.gamesLost," | Draws: ").concat(e.gamesDrawn);t.addShape(new m("text",{x:0,y:0,text:i,font:"16px GameFont",color:"white",align:"center",baseline:"middle",name:"stats_text"}))}function j(t){var e,i=new s({variant:s.VARIANT.TEXT,x:t.displayState.gameWidth/2,y:80,name:"title_text"});(e=i).addShape(new m("text",{x:0,y:0,text:"Noughts and Crosses",font:"60px GameFont",color:"white",align:"center",baseline:"middle"})),e.addShape(new m("line",{x:-350,y:35,x2:350,y2:35,color:"white",lineWidth:3})),e.addShape(new m("text",{x:0,y:60,text:"Stanley Skarshaug - USW student 23092388",font:"20px GameFont",color:"gray",align:"center",baseline:"middle"})),t.state.gameObjects.menu.push(i);var a=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth/2,y:t.displayState.gameHeight/5*4,name:"start_button",outline:{top:60,left:60,bottom:60,right:60}});!function(t){t.addShape(new m("rectangle",{x:-60,y:-60,width:120,height:120,color:"gray"})),t.addShape(new m("polygon",{x:-0,y:-0,points:[{x:-30,y:-40},{x:40,y:0},{x:-30,y:40}],color:"red",fillColor:"red"}))}(a),t.state.gameObjects.menu.push(a);var n=new s({variant:s.VARIANT.TEXT,x:50,y:230,name:"size_text"});n.addShape(P("Board Size:")),t.state.gameObjects.menu.push(n);for(var o=3;o<=8;o++){var r=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-480+80*(o-3),y:230,name:"size_button",outline:{top:30,left:30,bottom:30,right:30},boardSize:o});r.addShape(N()),r.addShape(E("".concat(o,"x").concat(o))),o===t.state.boardSize&&r.addShape(I()),t.state.gameObjects.menu.push(r)}var c=new s({variant:s.VARIANT.TEXT,x:50,y:310,name:"win_length_text"});c.addShape(P("Win Length:")),t.state.gameObjects.menu.push(c);for(var l=3;l<=8;l++){var g=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-480+80*(l-3),y:310,name:"win_length_button",outline:{top:30,left:30,bottom:30,right:30},winLength:l});g.addShape(N()),g.addShape(E("".concat(l))),l===t.state.winLength&&g.addShape(I()),l>t.state.winLength&&g.addShape(R()),t.state.gameObjects.menu.push(g)}var f=new s({variant:s.VARIANT.TEXT,x:50,y:390,name:"game_type_text"});f.addShape(P("Game Type:")),t.state.gameObjects.menu.push(f);var h=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-480,y:390,name:"game_type_button",outline:{top:30,left:30,bottom:30,right:30},gameType:X.TYPE.NORMAL});h.addShape(N()),h.addShape(E("Nor")),h.addShape(I()),t.state.gameObjects.menu.push(h);var d=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-480+80,y:390,name:"game_type_button",outline:{top:30,left:30,bottom:30,right:30},gameType:X.TYPE.BLOCKED});d.addShape(N()),d.addShape(E("Blk")),t.state.gameObjects.menu.push(d);var u=new s({variant:s.VARIANT.TEXT,x:50,y:470,name:"player_2_type_text"});u.addShape(P("Player 2:")),t.state.gameObjects.menu.push(u);var p=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-480,y:470,name:"player_2_type_button",outline:{top:30,left:30,bottom:30,right:30},opponentType:X.OPPONENT.HUMAN});p.addShape(N()),p.addShape(E("Hum")),p.addShape(I()),t.state.gameObjects.menu.push(p);var y=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-480+80,y:470,name:"player_2_type_button",outline:{top:30,left:30,bottom:30,right:30},opponentType:X.OPPONENT.CPU});y.addShape(N()),y.addShape(E("CPU")),t.state.gameObjects.menu.push(y);var b=new s({variant:s.VARIANT.TEXT,x:t.displayState.gameWidth/2,y:t.displayState.gameHeight-40,name:"stats_text"});_(b,t.state.stats),t.state.gameObjects.menu.push(b)}function k(){if(!localStorage.getItem("gameStats")){localStorage.setItem("gameStats",JSON.stringify({gamesPlayed:0,gamesWon:0,gamesLost:0,gamesDrawn:0}))}return JSON.parse(localStorage.getItem("gameStats"))}function V(t,e){switch(t.state.stats.gamesPlayed++,e){case 1:t.state.stats.gamesWon++;break;case 2:t.state.stats.gamesLost++;break;default:t.state.stats.gamesDrawn++}var i;i=t.state.stats,localStorage.setItem("gameStats",JSON.stringify(i)),function(t){var e=t.state.gameObjects.menu.find(function(t){return"stats_text"===t.config.name});e&&(e.shapes=[],_(e,t.state.stats))}(t)}function C(t,e){t.state.gameObjects[X.VIEW.GAMEPLAY].forEach(function(i){if(0==t.state.gameOver&&i.config.variant==s.VARIANT.BOARD&&i.checkCollision(e.x,e.y)&&null==i.state.occupiedBy){switch(i.state.occupiedBy=t.state.currentPlayer,t.state.occupiedSpaces++,t.state.currentPlayer){case 1:!function(t,e){var i=new m("line",{x:t.config.cellPadding-t.config.cellWidth/2,y:t.config.cellPadding-t.config.cellHeight/2,x2:t.config.cellWidth/2-t.config.cellPadding,y2:t.config.cellHeight/2-t.config.cellPadding,color:"rgba(40, 151, 255, 1)",lineWidth:4});i.addAnimation(new h({duration:150})),e.addShape(i);var a=new m("line",{x:t.config.cellPadding-t.config.cellWidth/2,y:t.config.cellHeight/2-t.config.cellPadding,x2:t.config.cellWidth/2-t.config.cellPadding,y2:-t.config.cellHeight/2+t.config.cellPadding,color:"rgba(40, 151, 255, 1)",lineWidth:4});a.addAnimation(new h({duration:150,startDelay:150})),e.addShape(a)}(t,i);break;case 2:y(t,i)}var a=S(t,i);if(a)return A(t,a),t.state.gameOver=!0,W(t,"Player ".concat(t.state.currentPlayer," Wins!")),void V(t,t.state.currentPlayer);if(T(t))return O(t),t.state.gameOver=!0,W(t,"Draw"),void V(t,0);switch(t.state.currentPlayer){case 1:t.state.currentPlayer=2;break;case 2:t.state.currentPlayer=1}w(t)}i.config.variant==s.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)&&("pause_button"===i.config.name&&(t.state.view=X.VIEW.PAUSED),"stop_button"===i.config.name&&(t.state.view=X.VIEW.MENU))})}function D(t,e){t.state.gameObjects[X.VIEW.MENU].forEach(function(i){if(i.config.variant==s.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)){if("start_button"===i.config.name&&(t.state.view=X.VIEW.GAMEPLAY,t.resetState(),function(t){t.state.gameObjects.gameplay=t.state.gameObjects.gameplay.filter(function(t){return"win_line"!=t.config.name}),t.state.gameObjects.gameplay=t.state.gameObjects.gameplay.filter(function(t){return"gameover_text"!=t.config.name}),t.state.gameObjects.gameplay=t.state.gameObjects.gameplay.filter(function(t){return t.config.variant!==s.VARIANT.BOARD}),t.state.gameFields=[];for(var e=0;e<t.config.boardSize;e++){for(var i=[],a=0;a<t.config.boardSize;a++){var n=new s({variant:s.VARIANT.BOARD,x:t.config.cellWidth/2+e*t.config.cellWidth+t.config.boardMargin,y:t.config.cellHeight/2+a*t.config.cellHeight+t.config.boardMargin,name:"board_tile",outline:{top:t.config.cellHeight/2,left:t.config.cellWidth/2,bottom:t.config.cellHeight/2,right:t.config.cellWidth/2},location:{x:e,y:a}}),o=new m("rectangle",{x:-t.config.cellWidth/2,y:-t.config.cellHeight/2,width:t.config.cellWidth,height:t.config.cellHeight,color:"gray"});n.addShape(o),t.state.gameObjects.gameplay.push(n),i.push(n)}t.state.gameFields.push(i)}if(t.state.gameType===X.TYPE.BLOCKED)for(var r=t.state.boardSize-2,c=0;c<r;c++){for(;;){var l=Math.floor(Math.random()*t.state.boardSize),g=Math.floor(Math.random()*t.state.boardSize),f=t.state.gameFields[l][g];if(null==f.state.occupiedBy){f.state.occupiedBy=0,f.addShape(new m("rectangle",{x:-t.config.cellWidth/2+4,y:-t.config.cellHeight/2+4,width:t.config.cellWidth-8,height:t.config.cellHeight-8,color:"black",fillColor:"gray"})),f.addShape(new m("text",{x:0,y:0,text:"blocked",font:"".concat(t.config.cellWidth/8,"px Consolas"),color:"black",align:"center",baseline:"middle"}));break}}t.state.occupiedSpaces++}}(t)),"size_button"===i.config.name){if(i.config.boardSize===t.state.boardSize)return;t.state.boardSize=i.config.boardSize,t.state.boardSize<t.state.winLength&&(t.state.winLength=t.state.boardSize,L(t,"winLength","win_length_button")),L(t,"boardSize","size_button"),function(t){t.state.gameObjects[X.VIEW.MENU].forEach(function(e){e.config.variant==s.VARIANT.BUTTON&&"win_length_button"===e.config.name&&(e.removeShape("disabled_overlay"),e.config.winLength>t.state.boardSize&&e.addShape(R()))})}(t),t.updateConfig()}if("win_length_button"===i.config.name){if(i.config.winLength===t.state.winLength)return;if(i.config.winLength>t.state.boardSize)return;t.state.winLength=i.config.winLength,L(t,"winLength","win_length_button"),t.updateConfig()}"game_type_button"===i.config.name&&(t.state.gameType=i.config.gameType,L(t,"gameType","game_type_button")),"player_2_type_button"===i.config.name&&(t.state.opponentType=i.config.opponentType,L(t,"opponentType","player_2_type_button"))}})}function L(t,e,i){t.state.gameObjects[X.VIEW.MENU].forEach(function(a){a.config.variant==s.VARIANT.BUTTON&&a.config.name===i&&(a.removeShape("selected_indicator"),a.config[e]===t.state[e]&&a.addShape(I()))})}function U(t){t.state.userInputs.forEach(function(e){if("click"==e.type)switch(t.state.view){case X.VIEW.GAMEPLAY:C(t,e);break;case X.VIEW.PAUSED:!function(t,e){t.state.gameObjects[X.VIEW.PAUSED].forEach(function(i){i.config.variant==s.VARIANT.BUTTON&&i.checkCollision(e.x,e.y)&&("continue_button"===i.config.name&&(t.state.view=X.VIEW.GAMEPLAY),"stop_button"===i.config.name&&(t.state.view=X.VIEW.MENU))})}(t,e);break;case X.VIEW.MENU:D(t,e)}}),t.state.userInputs=[]}function B(t){t.state.cpuWaitTime-=t.displayState.deltaTime,t.state.cpuWaitTime>0||(t.state.cpuWaitTime=t.state.cpuMoveDelay,function(t){for(;;){var e=Math.floor(Math.random()*t.state.boardSize),i=Math.floor(Math.random()*t.state.boardSize),a=t.state.gameFields[e][i];if(null==a.state.occupiedBy){a.state.occupiedBy=t.state.currentPlayer,t.state.occupiedSpaces++,y(t,a),t.state.currentPlayer=1;var n=S(t,a);if(n){A(t,n),t.state.gameOver=!0,W(t,"CPU wins!"),V(t,2);break}if(T(t)){O(t),t.state.gameOver=!0,W(t,"Draw"),V(t,0);break}w(t);break}}}(t))}function M(t){var e,i=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-30,y:30,name:"continue_button",outline:{top:20,left:20,bottom:20,right:20}});(e=i).addShape(new m("rectangle",{x:-20,y:-20,width:40,height:40,color:"gray"})),e.addShape(new m("polygon",{points:[{x:-10,y:-10},{x:10,y:0},{x:-10,y:10}],color:"red",fillColor:"red"})),t.state.gameObjects.paused.push(i);var a=new s({variant:s.VARIANT.BUTTON,x:t.displayState.gameWidth-80,y:30,name:"stop_button",outline:{top:20,left:20,bottom:20,right:20}});b(a),t.state.gameObjects.paused.push(a);var n=new s({variant:s.VARIANT.TEXT,x:t.displayState.gameWidth/2,y:t.displayState.gameHeight/2,name:"pause_text"});!function(t){t.addShape(new m("text",{x:0,y:0,text:"Pause",font:"84px GameFont",align:"center",baseline:"middle",color:"white"}));var e=new m("line",{x:-130,y:30,x2:130,y2:30,color:"white",lineWidth:4});e.addAnimation(new h({duration:1e3,loop:h.INFINITE})),t.addShape(e)}(n),t.state.gameObjects.paused.push(n)}function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function z(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Y(a.key),a)}}function H(t,e,i){return(e=Y(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Y(t){var e=function(t,e){if("object"!=F(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=F(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==F(e)?e:e+""}var X=function(){function e(i){var a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=i,this.ctx=i.getContext("2d"),this.displayState={gameWidth:800,gameHeight:800,scale:1,devicePixelRatio:1,offsetX:0,offsetY:0,screenStartX:0,screenStartY:0,screenEndX:0,screenEndY:0,lastTime:0,deltaTime:0,fps:{accum:0,frames:0,avg:0}},a=this,window.addEventListener("resize",function(){t(a.ctx,a.displayState)}),a.canvas.addEventListener("click",function(t){var e=function(t,e,i){var a=i.getBoundingClientRect();return{x:(t.clientX-a.left)/e.scale*e.devicePixelRatio-e.offsetX,y:(t.clientY-a.top)/e.scale*e.devicePixelRatio-e.offsetY}}(t,a.displayState,a.canvas);a.state.userInputs.push({type:"click",x:e.x,y:e.y})}),function(t){var e=window.devicePixelRatio,i=function(){return+getComputedStyle(t).getPropertyValue("height").slice(0,-2)},a=function(){return+getComputedStyle(t).getPropertyValue("width").slice(0,-2)};t.setAttribute("width",a()*e),t.setAttribute("height",i()*e)}(this.canvas),this.state={view:e.VIEW.MENU,userInputs:[],gameType:e.TYPE.NORMAL,opponentType:e.OPPONENT.HUMAN,boardSize:3,winLength:3,currentPlayer:1,occupiedSpaces:0,gameOver:!1,gameFields:[],gameObjects:{gameplay:[],menu:[],paused:[]},cpuMoveDelay:500,cpuWaitTime:500,stats:k()},this.config={},this.updateConfig(),j(this),v(this),w(this),M(this),this.start()}return function(t,e,i){return e&&z(t.prototype,e),i&&z(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"updateConfig",value:function(){var t=this.state.boardSize;this.config={boardSize:t,boardMargin:60,cellWidth:680/t,cellHeight:680/t,cellPadding:20}}},{key:"resetState",value:function(){this.state.occupiedSpaces=0,this.state.gameOver=!1}},{key:"start",value:function(){var e=this;t(this.ctx,this.displayState),window.requestAnimationFrame(function(t){return e.gameLoop(t)})}},{key:"gameLoop",value:function(t){var i,a,n=this;!function(t,e){e.deltaTime=t-e.lastTime,e.lastTime=t,e.fps.accum+=Math.floor(1e3/e.deltaTime),e.fps.frames++,e.fps.frames>=60&&(e.fps.avg=Math.floor(e.fps.accum/e.fps.frames),e.fps.accum=0,e.fps.frames=0)}(t,this.displayState),this.state.gameOver||2!=this.state.currentPlayer||this.state.opponentType!==e.OPPONENT.CPU?U(this):B(this),this.state.gameObjects[this.state.view].forEach(function(t){t.update(n.displayState.deltaTime)}),i=this.ctx,a=this.displayState,i.clearRect(a.screenStartX,a.screenStartY,a.gameWidth+2*a.offsetX,a.gameHeight+2*a.offsetY),this.state.gameObjects[this.state.view].forEach(function(t){t.draw(n.ctx)}),window.requestAnimationFrame(function(t){return n.gameLoop(t)})}}])}();H(X,"TYPE",{NORMAL:0,BLOCKED:1}),H(X,"OPPONENT",{HUMAN:0,CPU:1}),H(X,"VIEW",{GAMEPLAY:"gameplay",MENU:"menu",PAUSED:"paused"}),window.onload=function(){var t=document.getElementById("gameCanvas");new X(t)}})();